<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Using NGINX as API Gateway" /><meta property="og:locale" content="en" /><meta name="description" content="Hi everyone!" /><meta property="og:description" content="Hi everyone!" /><link rel="canonical" href="http://marcospereirajr.com.br//posts/using-nginx-as-api-gateway/" /><meta property="og:url" content="http://marcospereirajr.com.br//posts/using-nginx-as-api-gateway/" /><meta property="og:site_name" content="Marcos Pereira" /><meta property="og:image" content="http://marcospereirajr.com.br//assets/img/posts/nginx.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-08T15:00:00-03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://marcospereirajr.com.br//assets/img/posts/nginx.jpeg" /><meta property="twitter:title" content="Using NGINX as API Gateway" /><meta name="twitter:site" content="@_marcos_pereira" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-13T12:00:35-03:00","datePublished":"2022-07-08T15:00:00-03:00","description":"Hi everyone!","headline":"Using NGINX as API Gateway","image":"http://marcospereirajr.com.br//assets/img/posts/nginx.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"http://marcospereirajr.com.br//posts/using-nginx-as-api-gateway/"},"url":"http://marcospereirajr.com.br//posts/using-nginx-as-api-gateway/"}</script><title>Using NGINX as API Gateway | Marcos Pereira</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marcos Pereira"><meta name="application-name" content="Marcos Pereira"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/profile/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marcos Pereira</a></div><div class="site-subtitle font-italic">Software Expert (Technical Manager) no Mercado Livre</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/marcospereirampj" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_marcos_pereira" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/marcospereirampj" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/4913645/marcos-pereira-j%c3%banior" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['marcospereira.mpj','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Using NGINX as API Gateway</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Using NGINX as API Gateway</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1657303200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 8, 2022 </em> </span> <span> Updated <em class="" data-ts="1657724435" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 13, 2022 </em> </span><div class="mt-3 mb-3"> <img data-src="/assets/img/posts/nginx.jpeg" class="preview-img bg" alt="Preview Image" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/_marcos_pereira">Marcos Pereira</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2109 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><p>Hi everyone!</p><p>If you ever need to deploy a reverse proxy, you may have heard of NGINX (engine x). In case you haven’t heard it yet, let’s talk a little about it here and how we can use it as an API Gateway.</p><h1 id="what-is-nginx">What is NGINX?</h1><p>NGINX is an HTTP server and reverse proxy, a mail proxy server, and a generic TCP/UDP proxy server.</p><p>According to Netcraft, NGINX served or proxied <a href="https://news.netcraft.com/archives/2022/05/30/may-2022-web-server-survey.html">21.67% of the busiest sites in May 2022</a>.</p><p>Currently, NGINX has an open-source version and a commercial version (NGINX Plus). In this post, we will try to use some of the features of the free version but also available in the paid version.</p><h1 id="what-is-an-api-gateway">What is an API Gateway?</h1><p>An API Gateway is a traffic manager that allows developers to create, publish, maintain, monitor, and secure APIs. In resume, it interfaces between external traffic and backend services.</p><p>Using an API Gateway has several advantages, such as:</p><ul><li>Make APIs more secure through a single interface.<li>Enable you to more easily enforce access control policies, rate limits, routing, mediation, etc.<li>Enables the most comprehensive collection of metrics</ul><p>That said, let’s put some concepts into practice!</p><h1 id="what-do-we-want">What do we want?</h1><p>Let’s say we have two APIs: a for products, which we call the <strong>Products API</strong>, and other for users, which we call the <strong>Users API</strong>. Initially, we will publish our APIs. Our architecture diagram starts like this:</p><p><img data-src="/assets/img/posts/nginx_gateway_1.png" alt="NGINX as API Gateway - First Step" data-proofer-ignore></p><p>We want to create the following routes:</p><ul><li><code class="language-plaintext highlighter-rouge">/api/products</code> -&gt; should point to the Products API service<li><code class="language-plaintext highlighter-rouge">/api/users</code> -&gt; should point to the Users API service</ul><p>A relevant feature in our settings is that we don’t want to expose our services publicly. Therefore, our only gateway should be the NGINX which we call API Gateway in the diagram above.</p><p>To simulate our API, we built two simple Python applications with fixed responses (<a href="https://github.com/marcospereirampj/nginx-api-gateway/tree/master/backends/products">Products API</a> and <a href="https://github.com/marcospereirampj/nginx-api-gateway/tree/master/backends/users">Users API</a>).</p><p>For that, let’s create a simple rule in our NGINX configuration file (<code class="language-plaintext highlighter-rouge">gateway.conf</code>):</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span> <span class="mi">80</span> <span class="s">default_server</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="s">[::]:80</span> <span class="s">default_server</span><span class="p">;</span>
 
   <span class="c1">#</span>
   <span class="c1"># Products API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/products</span> <span class="p">{</span>
       <span class="kn">proxy_pass</span> <span class="s">http://products_api:8001</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="c1">#</span>
   <span class="c1"># Users API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/users</span> <span class="p">{</span>
       <span class="kn">proxy_pass</span> <span class="s">http://users_api:8002</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>In the configuration above, notice that I created an alias for the API containers (see <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> - contains spoilers).</p><p>So, the expected answers are:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>GET http://localhost/api/products

{
  "name": "Product 1",
  "description": "Detail about product 1"
}

</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>GET http://localhost/api/users
{
  "name": "User 1",
  "email": "email@email.com"
}

</pre></table></code></div></div><p>In this way, we have NGINX serving as a reverse proxy. To improve the organization of our configurations we will define <code class="language-plaintext highlighter-rouge">upstream</code> for our API instead of directly using their address (alias). So we will have:</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">products_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">products_api:8001</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">upstream</span> <span class="s">users_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">users_api:8002</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And after:</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span> <span class="mi">80</span> <span class="s">default_server</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="s">[::]:80</span> <span class="s">default_server</span><span class="p">;</span>
   <span class="c1">#</span>
   <span class="c1"># Products API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/products</span> <span class="p">{</span>
       <span class="kn">proxy_pass</span> <span class="s">http://products_api_server</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="c1">#</span>
   <span class="c1"># Users API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/users</span> <span class="p">{</span>
       <span class="kn">proxy_pass</span> <span class="s">http://users_api_server</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">upstream</code> (<code class="language-plaintext highlighter-rouge">ngx_http_upstream_module</code>) is used to define groups of servers that can be referenced by the <code class="language-plaintext highlighter-rouge">proxy_pass</code>, <code class="language-plaintext highlighter-rouge">fastcgi_pass</code>, <code class="language-plaintext highlighter-rouge">uwsgi_pass</code>, <code class="language-plaintext highlighter-rouge">scgi_pass</code>, <code class="language-plaintext highlighter-rouge">memcached_pass</code>, and <code class="language-plaintext highlighter-rouge">grpc_pass directives</code>.</p><p>After applying our basic settings, let’s increment the Gateway.</p><h1 id="load-balance">Load Balance</h1><p>In the next scenario, let’s assume that our Users API got overloaded and we decided to add a new instance (<code class="language-plaintext highlighter-rouge">users_api_balance</code>) to receive requests from end-users.</p><p><img data-src="/assets/img/posts/nginx_gateway_2.png" alt="NGINX as API Gateway - First Step" data-proofer-ignore></p><p>We will configure our API Gateway to do this balancing. For that, we’ll add the new server to the Users API server group.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">products_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">products_api:8001</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">upstream</span> <span class="s">users_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">users_api:8002</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api_balance:8002</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Through the container logs, you can see that the requests are distributed among the servers.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>api-gateway-nginx    | 172.18.0.1 - - <span class="o">[</span>07/Jul/2022:22:52:49 +0000] <span class="s2">"GET /api/users HTTP/1.1"</span> 200 46
container_users_api  | 172.18.0.5 - - <span class="o">[</span>07/Jul/2022 22:52:49] <span class="s2">"GET /api/users HTTP/1.0"</span> 200
api-gateway-nginx    | 172.18.0.1 - - <span class="o">[</span>07/Jul/2022:22:52:49 +0000] <span class="s2">"GET /api/users HTTP/1.1"</span> 200 46
container_users_api_balance | 172.18.0.5 - - <span class="o">[</span>07/Jul/2022 22:52:50] <span class="s2">"GET /api/users HTTP/1.0"</span> 200
</pre></table></code></div></div><p>With these settings, the requests are distributed evenly (Round Robin) between servers. But how about we evolve our balancing rules? Now let’s define that we should direct the new request to the server with the lowest number of active connections. Again, we will only modify the Users API server group by passing the desired balancing method. In our case, it will be the <code class="language-plaintext highlighter-rouge">least_conn</code>.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">products_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">products_api:8001</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">upstream</span> <span class="s">users_api_server</span> <span class="p">{</span>
<span class="kn">least_conn</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api:8002</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api_balance:8002</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We’ll use this setup for now, but NGINX has a few other balancing methods:</p><ul><li>ip_hash:<li>Generic Hash<li>Random<li>Least Time (NGINX Plus only)</ul><p>More details in the <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/">official documentation</a>.</p><p>However, let’s assume tha the <code class="language-plaintext highlighter-rouge">users_api</code> server has a better infrastructure, and we want to prioritize requests to this server. We can do this through the <code class="language-plaintext highlighter-rouge">weight</code> parameter.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">products_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">products_api:8001</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">upstream</span> <span class="s">users_api_server</span> <span class="p">{</span>
<span class="kn">least_conn</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api:8002</span> <span class="s">weight=5</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api_balance:8002</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div><p>With that, the <code class="language-plaintext highlighter-rouge">users_api</code> server has a priority five times higher than the other servers.</p><h1 id="cache">Cache</h1><p>In this scenario, let’s assume that the Products API is not volatile, and we want to optimize for response time. For this, we will add a basic cache in API Gateway,</p><p>Only two directives are needed to enable basic caching: <code class="language-plaintext highlighter-rouge">proxy_cache_path</code> and <code class="language-plaintext highlighter-rouge">proxy_cache</code>. The <code class="language-plaintext highlighter-rouge">proxy_cache_path</code> directive sets the path and configuration of the cache, and the <code class="language-plaintext highlighter-rouge">proxy_cache</code> directive activates it.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">products_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">products_api:8001</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">upstream</span> <span class="s">users_api_server</span> <span class="p">{</span>
       <span class="kn">ip_hash</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api:8002</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api_balance:8002</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="k">proxy_cache_path</span> <span class="n">/tmp/products</span> <span class="s">levels=1:2</span> <span class="s">keys_zone=products_cache:10m</span> <span class="s">max_size=10g</span> <span class="s">inactive=60m</span> <span class="s">use_temp_path=off</span><span class="p">;</span>
 
<span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span> <span class="mi">80</span> <span class="s">default_server</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="s">[::]:80</span> <span class="s">default_server</span><span class="p">;</span>
 
   <span class="c1">#</span>
   <span class="c1"># Products API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/products</span> <span class="p">{</span>
       <span class="kn">proxy_cache</span> <span class="s">products_cache</span><span class="p">;</span>
       <span class="kn">proxy_pass</span> <span class="s">http://products_api_server</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="c1">#</span>
   <span class="c1"># Users API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/users</span> <span class="p">{</span>
       <span class="kn">proxy_pass</span> <span class="s">http://users_api_server</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>The parameters to the <code class="language-plaintext highlighter-rouge">proxy_cache_path</code> directive define the following settings:</p><ul><li>The local disk directory for the cache is called <code class="language-plaintext highlighter-rouge">/tmp/products</code>.<li><code class="language-plaintext highlighter-rouge">levels </code>sets up a two‑level directory hierarchy under <code class="language-plaintext highlighter-rouge">/tmp/products</code>. If the <code class="language-plaintext highlighter-rouge">levels</code> parameter is not included, NGINX puts all files in the same directory.<li><code class="language-plaintext highlighter-rouge">keys_zone</code> sets up a shared memory zone for storing the cache keys and metadata such as usage timers.<li><code class="language-plaintext highlighter-rouge">max_size</code> sets the upper limit of the size of the cache (to 10 gigabytes in this example). It is optional; not specifying a value allows the cache to grow to use all available disk space.<li><code class="language-plaintext highlighter-rouge">inactive</code> specifies how long an item can remain in the cache without being accessed. In this example, a file that has not been requested for 60 minutes is automatically deleted from the cache by the cache manager process, regardless of whether or not it has expired. The default value is 10 minutes (10m).<li>NGINX first writes files that are destined for the cache to a temporary storage area, and the <code class="language-plaintext highlighter-rouge">use_temp_path=off</code> directive instructs NGINX to write them to the same directories where they will be cached.</ul><p>The default form of the keys that NGINX generates is similar to an MD5 hash of the following NGINX variables: <code class="language-plaintext highlighter-rouge">$scheme$proxy_host$request_uri;</code> the actual algorithm used is slightly more complicated.</p><p>More details on caching can be seen on the NGINX Blog: <a href="https://www.nginx.com/blog/nginx-caching-guide/">A Guide to Caching with NGINX and NGINX Plus.</a></p><h1 id="rate-limit">Rate Limit</h1><p>Having defined our balancing and cache rules, we can now protect our internal services from a large number of requests (DDoS attacks) by setting a rate limit for consumers.</p><p>Rate limiting is configured with two main directives, <code class="language-plaintext highlighter-rouge">limit_req_zone</code> and <code class="language-plaintext highlighter-rouge">limit_req</code>. The <code class="language-plaintext highlighter-rouge">limit_req_zone</code> directive defines the parameters for rate limiting while <code class="language-plaintext highlighter-rouge">limit_req</code> enables rate limiting within the context where it appears.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">products_api_server</span> <span class="p">{</span>
       <span class="kn">server</span> <span class="s">products_api:8001</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">upstream</span> <span class="s">users_api_server</span> <span class="p">{</span>
       <span class="kn">ip_hash</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api:8002</span><span class="p">;</span>
       <span class="kn">server</span> <span class="s">users_api_balance:8002</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="k">proxy_cache_path</span> <span class="n">/tmp/products</span> <span class="s">levels=1:2</span> <span class="s">keys_zone=products_cache:10m</span> <span class="s">max_size=10g</span> <span class="s">inactive=60m</span> <span class="s">use_temp_path=off</span><span class="p">;</span>
<span class="k">limit_req_zone</span> <span class="nv">$binary_remote_addr</span> <span class="s">zone=products_rate:10m</span> <span class="s">rate=1r/s</span><span class="p">;</span>
<span class="k">limit_req_zone</span> <span class="nv">$binary_remote_addr</span> <span class="s">zone=user_rate:10m</span> <span class="s">rate=10r/s</span><span class="p">;</span>
 
 
<span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span> <span class="mi">80</span> <span class="s">default_server</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="s">[::]:80</span> <span class="s">default_server</span><span class="p">;</span>
 
   <span class="c1">#</span>
   <span class="c1"># Products API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/products</span> <span class="p">{</span>
       <span class="kn">proxy_cache</span> <span class="s">products_cache</span><span class="p">;</span>
       <span class="kn">limit_req</span> <span class="s">zone=products_rate</span><span class="p">;</span>
       <span class="kn">limit_req_status</span> <span class="mi">429</span><span class="p">;</span>
       <span class="kn">proxy_pass</span> <span class="s">http://products_api_server</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="c1">#</span>
   <span class="c1"># Users API</span>
   <span class="c1">#</span>
   <span class="kn">location</span> <span class="n">/api/users</span> <span class="p">{</span>
       <span class="kn">limit_req</span> <span class="s">zone=user_rate</span><span class="p">;</span>
       <span class="kn">limit_req_status</span> <span class="mi">429</span><span class="p">;</span>
       <span class="kn">proxy_pass</span> <span class="s">http://users_api_server</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">limit_req_zone</code> takes the following three parameters:</p><ul><li>Key – Defines the request characteristic against which the limit is applied. In the example it is the NGINX variable <code class="language-plaintext highlighter-rouge">$binary_remote_addr</code>, which holds a binary representation of a client’s IP address. This means we are limiting each unique IP address to the request rate defined by the third parameter.<li>Zone – Defines the shared memory zone used to store the state of each IP address and how often it has accessed a request‑limited URL. Keeping the information in shared memory means it can be shared among the NGINX worker processes.<li>Rate – Sets the maximum request rate. In the example, the rate cannot exceed 10 request per second for Users API and 1 requests per second for Products API.</ul><p>By default, NGINX will return 503 (Service Temporarily Unavailable) when the request limit is reached. To improve this, we use <code class="language-plaintext highlighter-rouge">limit_req_status</code> to customize the response status code. In this case we use 429 (Too Many Requests).</p><p>More details on using rate limit can be seen on the NGINX Blog: <a href="https://www.nginx.com/blog/rate-limiting-nginx/">Rate Limiting with NGINX and NGINX Plus</a></p><h1 id="api-key-authentication">API Key Authentication</h1><p>It is unusual to publish APIs without some form of authentication to protect them. NGINX offers several approaches for protecting APIs and authenticating API clients. In our solution, we will use a simple solution to validate access to our services. We will use <a href="https://blog.stoplight.io/api-keys-best-practices-to-authenticate-apis">API Keys Authentication</a>.</p><p>With API key authentication, we use a map block to create an allowlist of client names that can access our services.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">map</span> <span class="nv">$http_apikey</span> <span class="nv">$api_client_name</span> <span class="p">{</span>
    <span class="kn">default</span>       <span class="s">""</span><span class="p">;</span>
    <span class="kn">"KrtKNkLNGcwKQ56la4jcHwxF"</span>  <span class="s">"client_one"</span><span class="p">;</span>
    <span class="kn">"sqj3Ye0vFW/CM/o7LTSMEMM+"</span>  <span class="s">"client_two"</span><span class="p">;</span>
    <span class="kn">"diXnbzglAWMMIvyEEV3rq7Kt"</span>  <span class="s">"client_ten"</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The map directive takes two parameters. The first defines where to find the API key, in this case in the <code class="language-plaintext highlighter-rouge">apikey</code> HTTP header of the client request as captured in the <code class="language-plaintext highlighter-rouge">$http_apikey</code> variable. The second parameter creates a new variable (<code class="language-plaintext highlighter-rouge">$api_client_name</code>) and sets it to the value of the second parameter on the line where the first parameter matches the key.</p><p>Now enable API Key authentication on our services. Just to avoid code duplication I will separate the API Key validation into another method.</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># API key validation</span>
<span class="k">location</span> <span class="p">=</span> <span class="n">/_validate_apikey</span> <span class="p">{</span>
    <span class="kn">internal</span><span class="p">;</span>

    <span class="kn">if</span> <span class="s">(</span><span class="nv">$http_apikey</span> <span class="p">=</span> <span class="s">"")</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">401</span><span class="p">;</span> <span class="c1"># Unauthorized</span>
    <span class="p">}</span>
    <span class="kn">if</span> <span class="s">(</span><span class="nv">$api_client_name</span> <span class="p">=</span> <span class="s">"")</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">403</span><span class="p">;</span> <span class="c1"># Forbidden</span>
    <span class="p">}</span>

    <span class="kn">return</span> <span class="mi">204</span><span class="p">;</span> <span class="c1"># OK (no content)</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">#</span>
<span class="c1"># Products API</span>
<span class="c1">#</span>
<span class="k">location</span> <span class="n">/api/products</span> <span class="p">{</span>
    <span class="kn">auth_request</span> <span class="n">/_validate_apikey</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="s">products_cache</span><span class="p">;</span>
    <span class="kn">limit_req</span> <span class="s">zone=products_rate</span><span class="p">;</span>
    <span class="kn">limit_req_status</span> <span class="mi">429</span><span class="p">;</span>
    <span class="kn">proxy_pass</span> <span class="s">http://products_api_server</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#</span>
<span class="c1"># Users API</span>
<span class="c1">#</span>
<span class="k">location</span> <span class="n">/api/users</span> <span class="p">{</span>
    <span class="kn">auth_request</span> <span class="n">/_validate_apikey</span><span class="p">;</span>
    <span class="kn">limit_req</span> <span class="s">zone=user_rate</span><span class="p">;</span>
    <span class="kn">limit_req_status</span> <span class="mi">429</span><span class="p">;</span>
    <span class="kn">proxy_pass</span> <span class="s">http://users_api_server</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>With this configuration in place, the Products API and Users APIs now implements API key authentication.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>curl <span class="nt">-I</span> <span class="s1">'http://localhost/api/products'</span> <span class="nt">--header</span> <span class="s1">'apikey: INVALID_KEY'</span>
HTTP/1.1 403 Forbidden
Server: nginx/1.21.5
Date: Sat, 09 Jul 2022 02:24:03 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>curl <span class="nt">-I</span> <span class="s1">'http://localhost/api/products'</span> <span class="nt">--header</span> <span class="s1">'apikey: diXnbzglAWMMIvyEEV3rq7Kt'</span>
HTTP/1.1 200 OK
Server: nginx/1.21.5
Date: Sat, 09 Jul 2022 02:25:03 GMT
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length: 62
Connection: keep-alive
</pre></table></code></div></div><p>Note that the above solution is quite limited, but it is possible to <a href="https://www.nginx.com/blog/authenticating-api-clients-jwt-nginx-plus/">authenticate using JWT</a>. However, this functionality is natively only available in NGINX Plus. For NGINX open source, an introspection endpoint is required to perform the validation.</p><p>Other more robust solutions are using that can be used for authentication, are: <a href="https://curity.io/resources/learn/nginx-oauth-proxy-module/">OAuth Proxy Module</a> or <a href="https://curity.io/resources/learn/nginx-phantom-token-module/">Phantom Token Module</a>.</p><h1 id="conclusion">Conclusion</h1><p>Finally, our final architecture is shown in the diagram below. <a href="https://github.com/marcospereirampj/nginx-api-gateway">Here</a> you can find all the codes we developed.</p><p><img data-src="/assets/img/posts/nginx_gateway_3.png" alt="NGINX as API Gateway - First Step" data-proofer-ignore></p><p>In addition to the features presented in this article, NGINX offers several others (especially in NGINX Plus). Several of them can be found in the free <a href="https://www.nginx.com/resources/library/nginx-api-gateway-deployment/">ebook</a> or on the tool’s <a href="https://www.nginx.com/blog/">official blog</a>.</p><p>Well, that’s it, folks. I hope you enjoyed the article. See you soon!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/microservices/'>microservices</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nginx/" class="post-tag no-text-decoration" >nginx</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >devops</a> <a href="/tags/api-gateway/" class="post-tag no-text-decoration" >api gateway</a> <a href="/tags/microservices/" class="post-tag no-text-decoration" >microservices</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Using+NGINX+as+API+Gateway+-+Marcos+Pereira&url=http%3A%2F%2Fmarcospereirajr.com.br%2F%2Fposts%2Fusing-nginx-as-api-gateway%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Using+NGINX+as+API+Gateway+-+Marcos+Pereira&u=http%3A%2F%2Fmarcospereirajr.com.br%2F%2Fposts%2Fusing-nginx-as-api-gateway%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=http%3A%2F%2Fmarcospereirajr.com.br%2F%2Fposts%2Fusing-nginx-as-api-gateway%2F&text=Using+NGINX+as+API+Gateway+-+Marcos+Pereira" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/using-nginx-as-api-gateway/">Using NGINX as API Gateway</a><li><a href="/posts/virtualenv-ambiente-virtuais-isolados-em-python/">Virtualenv: Ambiente virtuais isolados em Python</a><li><a href="/posts/servindo-aplicacoes-django-com-nginx-supervisor-gunicorn-virtualenv/">Servindo Aplicações Django com NGINX + Supervisor + Gunicorn + Virtualenv</a><li><a href="/posts/golang-scaffolding/">Scaffolding for the golang project</a><li><a href="/posts/django-e-migrations-manipulacao-de-base-de-dados/">Django e Migrations: Manipulação de Base de Dados</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/general/">general</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/migrations/">migrations</a> <a class="post-tag" href="/tags/api-gateway/">api gateway</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/golang-scaffolding/"><div class="card-body"> <em class="small" data-ts="1656950400" data-df="ll" > Jul 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Scaffolding for the golang project</h3><div class="text-muted small"><p> Hello guys! We’re back! As I did for projects using Django I created scaffolding for projects in Golang. In the scaffolding project I used some dependencies: go-chi as the HTTP router. uber-...</p></div></div></a></div><div class="card"> <a href="/posts/django-getting-started/"><div class="card-body"> <em class="small" data-ts="1515686400" data-df="ll" > Jan 11, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Getting Started with Django 2</h3><div class="text-muted small"><p> Eai pessoal! Disponibilizei no meu GitHub um simples projeto para a galera que está iniciando/testando o Django (versão 2.0). Basicamente, é uma pequena variação do Getting Started disponibilizado...</p></div></div></a></div><div class="card"> <a href="/posts/carreira-de-desenvolvedor/"><div class="card-body"> <em class="small" data-ts="1510372800" data-df="ll" > Nov 11, 2017 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A Carreira de Desenvolvedor: Do Jr ao Sênior</h3><div class="text-muted small"><p> Eai pessoal! Essa semana tive a oportunidade de compartilhar um pouco das minhas experiências profissionais com os alunos do Instituto Federal de Santa Cantarina (Campus Canoinhas) no I Workshop de...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/golang-scaffolding/" class="btn btn-outline-primary" prompt="Older"><p>Scaffolding for the golang project</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'http://marcospereirajr.com.br//posts/using-nginx-as-api-gateway/'; this.page.identifier = '/posts/using-nginx-as-api-gateway/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://http-marcospereirajr-com-br.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/_marcos_pereira">Marcos Pereira</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/general/">general</a> <a class="post-tag" href="/tags/personal/">personal</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/migrations/">migrations</a> <a class="post-tag" href="/tags/api-gateway/">api gateway</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-SP182BLV6S"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SP182BLV6S'); }); </script>
